<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>StickShot Redux Revamped</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
/* — RESET / BASE — */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;background:#0d0d0d;font-family:'Poppins',sans-serif;overflow:hidden;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}

/* — CANVAS — */
canvas{display:block;width:100%;height:100%}

/* — COLORS — */
:root{
  --fg:#f1faee;
  --accent:#e63946;
  --glass:rgba(255,255,255,.12);
}

/* — OVERLAYS — */
.overlay{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;
  background:rgba(13,13,13,.85);backdrop-filter:blur(10px);color:var(--fg);z-index:20;animation:fadeIn .6s forwards}
.overlay.fade{animation:fadeOut .6s forwards}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes fadeOut{to{opacity:0;transform:scale(.9)}}
.overlay h1{font-size:3rem;margin-bottom:.5rem}
.overlay p{font-size:1.2rem;animation:blink 1.5s infinite}
@keyframes blink{0%,50%,100%{opacity:1}25%,75%{opacity:.4}}
.overlay small{opacity:.7;margin-top:1rem;font-size:.8rem}

/* — HUD — */
#hud{position:absolute;top:1rem;left:1rem;right:1rem;display:flex;justify-content:space-between;z-index:10}
.hud-box{display:flex;align-items:center;background:var(--glass);backdrop-filter:blur(4px);
  padding:.5rem 1rem;border-radius:.6rem;color:var(--fg)}
#hp-bar-container{width:120px;height:16px;background:rgba(255,255,255,.25);border-radius:8px;overflow:hidden;margin-right:.5rem}
#hp-bar{height:100%;width:100%;background:var(--accent);transition:width .3s ease}

/* — CONTROLS — */
#controls{position:absolute;bottom:1rem;left:1rem;right:1rem;display:flex;justify-content:space-between;z-index:15;pointer-events:none}
#dpad{display:grid;grid-template-areas:" . up ." "left down right";gap:.6rem;pointer-events:auto}
#dpad button,#shoot{width:64px;height:64px;border:none;border-radius:1rem;font-size:1.6rem;
  background:var(--glass);color:var(--fg);box-shadow:0 4px 8px rgba(0,0,0,.4);transition:.1s transform,.3s background;
  -webkit-tap-highlight-color:transparent}
#dpad button:hover,#shoot:hover{background:rgba(230,57,70,.8)}
#dpad button:active,#shoot:active{transform:scale(.9)}
#up{grid-area:up}#down{grid-area:down}#left{grid-area:left}#right{grid-area:right}
#shoot{background:var(--accent);border-radius:50%;pointer-events:auto}

/* — GAME OVER — */
#gameOver{display:none}
#gameOver h2{font-size:2.4rem;margin-bottom:.4rem}
#gameOver p{font-size:1.1rem;margin-bottom:1rem}
#gameOver ol{list-style:none;width:80%;max-width:300px;max-height:160px;overflow-y:auto;margin-bottom:1rem}
#gameOver li{display:flex;justify-content:space-between;background:var(--glass);padding:.5rem;margin-bottom:.4rem;border-radius:.4rem;font-size:.9rem}
#gameOver input,#gameOver button{width:80%;max-width:300px;padding:.7rem 1rem;border:none;border-radius:.6rem;font-size:1rem}
#gameOver input{background:var(--glass);color:var(--fg)}
#gameOver button{background:var(--accent);color:var(--fg);cursor:pointer;transition:.1s transform,.3s background}
#gameOver button:hover{background:#d62828}
#gameOver button:active{transform:scale(.95)}
</style>
</head>
<body>

<!-- START -->
<div id="startOverlay" class="overlay">
  <h1>StickShot Redux</h1>
  <p>Tap to Start</p>
  <small>Allow motion & orientation</small>
</div>

<!-- CANVAS -->
<canvas id="gameCanvas"></canvas>

<!-- HUD -->
<div id="hud">
  <div class="hud-box">
    <div id="hp-bar-container"><div id="hp-bar"></div></div>
    <span id="hp-text">100</span>
  </div>
  <div class="hud-box">Score <span id="score">0</span></div>
</div>

<!-- CONTROLS -->
<div id="controls">
  <div id="dpad">
    <button id="up">▲</button>
    <button id="left">◀</button>
    <button id="down">▼</button>
    <button id="right">▶</button>
  </div>
  <button id="shoot">Shoot</button>
</div>

<!-- GAME OVER -->
<div id="gameOver" class="overlay">
  <h2>Game Over</h2>
  <p>Your Score: <span id="finalScore">0</span></p>
  <button id="restartGame">Restart</button>
</div>

<!-- THREE JS -->
<script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>
<script>
/* — GLOBAL STATE — */
let scene,camera,renderer,clock;
let player,playerGroup,bullets=[],enemies=[];
let move={forward:false,back:false,left:false,right:false},yaw=0;
let hp=100,score=0,gameRunning=false;

/* — INIT — */
function init(){
  /* SCENE */
  scene=new THREE.Scene();
  scene.background=new THREE.Color(0x000000);

  /* CAMERA */
  camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,.1,1000);

  /* LIGHTS */
  const light=new THREE.HemisphereLight(0xffffff,0x444444,1.2);
  scene.add(light);

  /* PLAYER */
  playerGroup=new THREE.Group();
  // simple stick‑figure: body line + head sphere
  const mat=new THREE.MeshStandardMaterial({color:0xffffff});
  const bodyGeo=new THREE.CylinderGeometry(.1,.1,1.5,6);
  const body=new THREE.Mesh(bodyGeo,mat);
  body.position.y=.75;
  const head=new THREE.Mesh(new THREE.SphereGeometry(.25,16,16),mat);
  head.position.y=1.6;
  playerGroup.add(body,head);
  scene.add(playerGroup);

  /* FLOOR */
  const floor=new THREE.Mesh(
    new THREE.PlaneGeometry(200,200,20,20),
    new THREE.MeshStandardMaterial({color:0x222222,wireframe:true})
  );
  floor.rotation.x=-Math.PI/2;
  scene.add(floor);

  /* RENDERER */
  renderer=new THREE.WebGLRenderer({canvas:document.getElementById("gameCanvas"),antialias:true});
  renderer.setSize(innerWidth,innerHeight);
  renderer.setPixelRatio(devicePixelRatio);

  clock=new THREE.Clock();

  /* SPAWN LOOP */
  setInterval(spawnEnemy,2000);

  /* EVENTS */
  addControlEvents();
  window.addEventListener("resize",()=>renderer.setSize(innerWidth,innerHeight));

  gameRunning=true;
  animate();
}

/* — CONTROLS — */
function addControlEvents(){
  const btn=(id,dir)=>{const el=document.getElementById(id);
    const set=(v)=>move[dir]=v;
    ["pointerdown","touchstart"].forEach(e=>el.addEventListener(e,ev=>{ev.preventDefault();set(true)}));
    ["pointerup","pointerleave","touchend","touchcancel"].forEach(e=>el.addEventListener(e,()=>set(false)));
  };
  btn("up","forward");btn("down","back");btn("left","left");btn("right","right");

  const shootBtn=document.getElementById("shoot");
  ["pointerdown","touchstart","mousedown"].forEach(e=>shootBtn.addEventListener(e,ev=>{
    ev.preventDefault();shoot();
  }));

  /* SWIPE ROTATION */
  let prevX=null;
  window.addEventListener("pointerdown",e=>{prevX=e.clientX});
  window.addEventListener("pointermove",e=>{
    if(prevX!==null){
      const dx=e.clientX-prevX;
      yaw-=dx*0.0025; // swipe speed
      prevX=e.clientX;
    }
  });
  window.addEventListener("pointerup",()=>prevX=null);
}

/* — PLAYER UPDATE — */
function updatePlayer(dt){
  const dir=new THREE.Vector3(0,0,-1).applyAxisAngle(new THREE.Vector3(0,1,0),yaw);
  const side=new THREE.Vector3(-1,0,0).applyAxisAngle(new THREE.Vector3(0,1,0),yaw);
  const speed=5*dt;
  if(move.forward)playerGroup.position.addScaledVector(dir,speed);
  if(move.back)   playerGroup.position.addScaledVector(dir,-speed);
  if(move.left)   playerGroup.position.addScaledVector(side,speed);
  if(move.right)  playerGroup.position.addScaledVector(side,-speed);
  playerGroup.rotation.y=yaw;

  /* Camera follow */
  const camOffset=new THREE.Vector3(0,2,6).applyAxisAngle(new THREE.Vector3(0,1,0),yaw);
  camera.position.copy(playerGroup.position).add(camOffset);
  camera.lookAt(playerGroup.position);
}

/* — SHOOT — */
function shoot(){
  const geo=new THREE.SphereGeometry(.1,8,8);
  const mat=new THREE.MeshBasicMaterial({color:0xffff00});
  const bullet=new THREE.Mesh(geo,mat);
  const dir=new THREE.Vector3(0,0,-1).applyAxisAngle(new THREE.Vector3(0,1,0),yaw).normalize();
  bullet.position.copy(playerGroup.position).add(dir.clone().multiplyScalar(.8)).y+=1;
  bullet.userData={velocity:dir.multiplyScalar(15)};
  scene.add(bullet);
  bullets.push(bullet);
}

/* — ENEMY SPAWN — */
function spawnEnemy(){
  if(!gameRunning)return;
  const geo=new THREE.BoxGeometry(.8,.8,.8);
  const mat=new THREE.MeshStandardMaterial({color:0xff0000,metalness:.3,roughness:.6});
  const enemy=new THREE.Mesh(geo,mat);
  const radius=15;
  const angle=Math.random()*Math.PI*2;
  enemy.position.set(
    playerGroup.position.x+radius*Math.cos(angle),
    .4,
    playerGroup.position.z+radius*Math.sin(angle)
  );
  enemy.lookAt(playerGroup.position);
  enemy.userData={speed:1.5};
  scene.add(enemy);
  enemies.push(enemy);
}

/* — COLLISION DETECTION — */
function checkCollisions(){
  // bullet / enemy
  bullets.forEach((b,bIndex)=>{
    enemies.forEach((en,eIndex)=>{
      if(b.position.distanceTo(en.position)<.6){
        // hit
        scene.remove(b);scene.remove(en);
        bullets.splice(bIndex,1);
        enemies.splice(eIndex,1);
        score+=10;
        document.getElementById("score").textContent=score;
      }
    });
  });
  // enemy / player
  enemies.forEach((en,eIndex)=>{
    if(en.position.distanceTo(playerGroup.position)<1){
      hp-=10;
      document.getElementById("hp-bar").style.width=hp+"%";
      document.getElementById("hp-text").textContent=hp;
      scene.remove(en);
      enemies.splice(eIndex,1);
      if(hp<=0)endGame();
    }
  });
}

/* — ANIMATE — */
function animate(){
  if(!gameRunning)return;
  requestAnimationFrame(animate);
  const dt=clock.getDelta();

  updatePlayer(dt);

  /* Update bullets */
  bullets.forEach((b,i)=>{
    b.position.addScaledVector(b.userData.velocity,dt);
    if(b.position.distanceTo(playerGroup.position)>50){
      scene.remove(b);bullets.splice(i,1);
    }
  });

  /* Update enemies */
  enemies.forEach(en=>{
    const toPlayer=new THREE.Vector3().subVectors(playerGroup.position,en.position).setY(0).normalize();
    en.position.addScaledVector(toPlayer,en.userData.speed*dt);
  });

  checkCollisions();
  renderer.render(scene,camera);
}

/* — GAME FLOW — */
function startGame(){
  document.getElementById("startOverlay").classList.add("fade");
  setTimeout(()=>document.getElementById("startOverlay").style.display="none",600);
  init();
}
function endGame(){
  gameRunning=false;
  document.getElementById("finalScore").textContent=score;
  document.getElementById("gameOver").style.display="flex";
}
function resetGame(){
  // clean scene
  bullets.forEach(b=>scene.remove(b));
  enemies.forEach(e=>scene.remove(e));
  bullets=[];enemies=[];
  hp=100;score=0;
  document.getElementById("hp-bar").style.width="100%";
  document.getElementById("hp-text").textContent="100";
  document.getElementById("score").textContent="0";
  playerGroup.position.set(0,0,0);
  yaw=0;
  document.getElementById("gameOver").style.display="none";
  gameRunning=true;
  clock.start();
  animate();
}

/* — EVENT BINDINGS — */
document.getElementById("restartGame").addEventListener("click",resetGame);
["pointerdown","touchstart"].forEach(e=>document.getElementById("startOverlay").addEventListener(e,startGame,{once:true}));
</script>
</body>
</html>