<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Sexy 3D Shooter Revamped</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      touch-action: none;
    }
    canvas {
      display: block;
    }
    /* HUD */
    #hud {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #0f0;
      font-family: 'Orbitron', sans-serif;
      font-size: 18px;
      z-index: 10;
      text-shadow: 0 0 4px rgba(0,255,0,0.7);
    }
    #hud span {
      margin-right: 30px;
    }
    /* Game Over Overlay */
    #gameover {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #f00;
      font-family: 'Orbitron', sans-serif;
      font-size: 48px;
      text-align: center;
      display: none;
      z-index: 20;
    }
    #gameover button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 20px;
      border: none;
      border-radius: 6px;
      background: #f00;
      color: #000;
      cursor: pointer;
      text-shadow: 0 0 4px #000;
    }
    /* Joystick */
    #joystickContainer {
      position: absolute;
      bottom: 20px;
      left: 20px;
      width: 120px;
      height: 120px;
      z-index: 15;
      touch-action: none;
    }
    #joystickBase {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      border: 2px solid rgba(255,255,255,0.3);
    }
    #joystickThumb {
      position: absolute;
      width: 48px;
      height: 48px;
      top: 36px;
      left: 36px;
      border-radius: 50%;
      background: rgba(0,255,255,0.7);
      box-shadow: 0 0 12px rgba(0,255,255,0.9);
      touch-action: none;
    }
    /* Fire Button */
    #shootButton {
      position: absolute;
      bottom: 40px;
      right: 20px;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #f00, #800);
      border: 4px solid #fff;
      font-family: sans-serif;
      font-size: 18px;
      color: #fff;
      text-shadow: 0 0 4px #000;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 15;
      touch-action: none;
    }
    #shootButton:active {
      transform: scale(0.9);
    }
  </style>
</head>
<body>
  <!-- HUD -->
  <div id="hud">
    <span id="score">Score: 0</span>
    <span id="health">Health: 100</span>
  </div>

  <!-- Game Over -->
  <div id="gameover">
    GAME OVER
    <br>
    <button id="restart">Restart</button>
  </div>

  <!-- Joystick -->
  <div id="joystickContainer">
    <div id="joystickBase"></div>
    <div id="joystickThumb"></div>
  </div>

  <!-- Fire Button -->
  <div id="shootButton">FIRE</div>

  <!-- Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
  <script>
    let scene, camera, renderer, ship, starField
    let bullets = [], enemies = [], score = 0, health = 100, gameOver = false
    let lastSpawn = 0
    const bulletRadius = 0.1
    const joystick = { x: 0, y: 0, id: null }
    let shootTouchId = null, shootInterval = null

    function init() {
      // Renderer & Scene
      scene = new THREE.Scene()
      camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 500)
      camera.position.set(0, 3, 12)
      camera.lookAt(0,0,0)
      renderer = new THREE.WebGLRenderer({antialias:true})
      renderer.setSize(innerWidth, innerHeight)
      document.body.appendChild(renderer.domElement)

      // Lights
      const dirLight = new THREE.DirectionalLight(0xffffff,1)
      dirLight.position.set(5,10,7)
      scene.add(dirLight)
      scene.add(new THREE.AmbientLight(0x202020))

      // Starfield
      const starGeo = new THREE.BufferGeometry()
      const starCount = 800
      const starPos = new Float32Array(starCount*3)
      for (let i = 0; i < starCount; i++) {
        starPos[i*3]   = (Math.random()*2 - 1)*100
        starPos[i*3+1] = (Math.random()*2 - 1)*100
        starPos[i*3+2] = (Math.random()*2 - 1)*-300
      }
      starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3))
      starField = new THREE.Points(starGeo, new THREE.PointsMaterial({color:0xffffff, size:0.7}))
      scene.add(starField)

      // Ship
      const shipGeo = new THREE.ConeGeometry(0.5,1.5,12)
      const shipMat = new THREE.MeshPhongMaterial({color:0x00ffff})
      ship = new THREE.Mesh(shipGeo, shipMat)
      ship.rotation.x = Math.PI/2
      scene.add(ship)

      // Joystick
      const base = document.getElementById('joystickBase')
      const thumb = document.getElementById('joystickThumb')
      base.addEventListener('touchstart', e => {
        e.preventDefault()
        if (joystick.id === null) {
          const t = e.changedTouches[0]
          joystick.id = t.identifier
          updateJoystick(t)
        }
      })
      base.addEventListener('touchmove', e => {
        e.preventDefault()
        for (let t of e.changedTouches) {
          if (t.identifier === joystick.id) {
            updateJoystick(t)
            break
          }
        }
      })
      base.addEventListener('touchend', e => {
        e.preventDefault()
        for (let t of e.changedTouches) {
          if (t.identifier === joystick.id) {
            joystick.id = null
            joystick.x = joystick.y = 0
            thumb.style.transform = ''
            break
          }
        }
      })

      // Fire Button
      const fireBtn = document.getElementById('shootButton')
      fireBtn.addEventListener('touchstart', e => {
        e.preventDefault()
        for (let t of e.changedTouches) {
          if (shootTouchId === null) {
            shootTouchId = t.identifier
            shoot()
            shootInterval = setInterval(shoot, 200)
            break
          }
        }
      })
      fireBtn.addEventListener('touchend', e => {
        e.preventDefault()
        for (let t of e.changedTouches) {
          if (t.identifier === shootTouchId) {
            clearInterval(shootInterval)
            shootTouchId = null
            break
          }
        }
      })

      // Restart
      document.getElementById('restart')
        .addEventListener('click', resetGame)

      window.addEventListener('resize', onResize)
    }

    function updateJoystick(touch) {
      const rect = document.getElementById('joystickBase').getBoundingClientRect()
      const cx = rect.left + rect.width/2
      const cy = rect.top  + rect.height/2
      const dx = touch.clientX - cx, dy = touch.clientY - cy
      const dist = Math.hypot(dx,dy), max = rect.width/2
      const clamped = Math.min(dist, max), angle = Math.atan2(dy,dx)
      const x = Math.cos(angle)*clamped, y = Math.sin(angle)*clamped
      document.getElementById('joystickThumb')
        .style.transform = `translate(${x}px,${y}px)`
      joystick.x = x/max
      joystick.y = -y/max
    }

    function onResize() {
      camera.aspect = innerWidth/innerHeight
      camera.updateProjectionMatrix()
      renderer.setSize(innerWidth, innerHeight)
    }

    function shoot() {
      if (gameOver) return
      const geo = new THREE.SphereGeometry(bulletRadius, 8, 8)
      const mat = new THREE.MeshBasicMaterial({color:0xffff00})
      const b = new THREE.Mesh(geo, mat)
      b.position.copy(ship.position).add(new THREE.Vector3(0,0,-1))
      b.userData = { vel: new THREE.Vector3(0,0,-1).multiplyScalar(1) }
      scene.add(b)
      bullets.push(b)
    }

    function spawnEnemy() {
      const radius = Math.random()*0.6 + 0.3
      const geo = new THREE.IcosahedronGeometry(radius,1)
      const mat = new THREE.MeshPhongMaterial({color:0xff5555, flatShading:true})
      const e = new THREE.Mesh(geo, mat)
      e.position.set((Math.random()-0.5)*12, (Math.random()-0.5)*8, -80)
      e.userData = { vel: new THREE.Vector3(0,0,0.1 + Math.random()*0.1), radius }
      scene.add(e)
      enemies.push(e)
    }

    function update() {
      const now = performance.now()
      if (now - lastSpawn > 800) {
        spawnEnemy()
        lastSpawn = now
      }

      // Move ship
      ship.position.x = THREE.MathUtils.clamp(ship.position.x + joystick.x*0.3, -8, 8)
      ship.position.y = THREE.MathUtils.clamp(ship.position.y + joystick.y*0.3, -5, 5)

      // Rotate starfield
      starField.rotation.y += 0.0004
      starField.rotation.x += 0.0002

      // Update bullets
      for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i]
        b.position.add(b.userData.vel)
        if (b.position.z < -150) {
          scene.remove(b)
          bullets.splice(i, 1)
        }
      }

      // Update enemies
      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i]
        e.position.add(e.userData.vel)
        if (e.position.z > 3) {
          scene.remove(e)
          enemies.splice(i, 1)
          hitPlayer()
        }
      }

      // Collisions
      for (let i = bullets.length - 1; i >= 0; i--) {
        for (let j = enemies.length - 1; j >= 0; j--) {
          const b = bullets[i], e = enemies[j]
          if (b.position.distanceTo(e.position) < bulletRadius + e.userData.radius) {
            scene.remove(b)
            scene.remove(e)
            bullets.splice(i,1)
            enemies.splice(j,1)
            score += 20
            updateHUD()
            break
          }
        }
      }
    }

    function hitPlayer() {
      health -= 20
      updateHUD()
      if (health <= 0) endGame()
    }

    function updateHUD() {
      document.getElementById('score').textContent  = 'Score: '  + score
      document.getElementById('health').textContent = 'Health: ' + health
    }

    function endGame() {
      gameOver = true
      document.getElementById('gameover').style.display = 'block'
    }

    function resetGame() {
      bullets.forEach(b=>scene.remove(b))
      enemies.forEach(e=>scene.remove(e))
      bullets = []; enemies = []
      score = 0; health = 100; gameOver = false
      ship.position.set(0,0,0)
      document.getElementById('gameover').style.display = 'none'
      updateHUD()
    }

    function animate() {
      requestAnimationFrame(animate)
      if (!gameOver) update()
      renderer.render(scene, camera)
    }

    init()
    animate()
  </script>
</body>
</html>