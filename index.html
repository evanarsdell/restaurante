<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width,
                 initial-scale=1.0,
                 maximum-scale=1.0,
                 minimum-scale=1.0,
                 user-scalable=no">
  <title>Stick Shot Mobile</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
        rel="stylesheet">
  <style>
    /* ─────── disable long‑press / double‑tap, no selection ─────── */
    html, body, canvas, #controls, button {
      touch-action: none;
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }

    :root {
      --bg: #0d0d0d;
      --fg: #f1faee;
      --accent: #e63946;
      --glass: rgba(255,255,255,0.12);
    }
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
    html, body { width:100%; height:100%; overflow:hidden; background:var(--bg); }
    canvas { display:block; width:100%; height:100%; }

    /* START OVERLAY */
    .overlay {
      position:absolute; top:0; left:0; width:100%; height:100%;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      background:rgba(13,13,13,0.8); backdrop-filter:blur(8px);
      color:var(--fg); z-index:20; text-align:center; padding:2rem;
    }
    .overlay h1 { font-size:3rem; margin-bottom:.5rem; font-weight:600; }
    .overlay p  { font-size:1.25rem; margin-bottom:.5rem; }
    .overlay small { opacity:.7; font-size:.8rem; }

    /* HUD */
    #hud {
      position:absolute; top:1rem; left:1rem; right:1rem;
      display:flex; justify-content:space-between; z-index:10;
    }
    .hud-box {
      background:var(--glass); backdrop-filter:blur(4px);
      padding:.4rem 1rem; border-radius:.6rem; color:var(--fg);
      font-weight:600; font-size:1.1rem;
    }

    /* CONTROLS */
    #controls {
      position:absolute; bottom:1rem; left:1rem; right:1rem;
      display:flex; justify-content:space-between; z-index:15; pointer-events:none;
    }
    #dpad {
      display:grid;
      grid-template-areas:
        ". up ."
        "left down right";
      grid-gap:.6rem;
      pointer-events:auto;
    }
    #dpad button, #shoot {
      width:64px; height:64px;
      background:var(--glass); border:none; border-radius:1rem;
      color:var(--fg); font-size:1.6rem; font-weight:600;
      box-shadow:0 4px 8px rgba(0,0,0,.4);
      transition:transform .1s; user-select:none;
    }
    #dpad button:active, #shoot:active { transform:scale(.9); }
    #up    { grid-area:up; }
    #down  { grid-area:down; }
    #left  { grid-area:left; }
    #right { grid-area:right; }
    #shoot {
      pointer-events:auto;
      background:var(--accent); border-radius:50%;
    }

    /* GAME OVER */
    #gameOver {
      position:absolute; top:0; left:0; width:100%; height:100%;
      display:none; flex-direction:column; align-items:center; justify-content:center;
      background:rgba(13,13,13,0.8); backdrop-filter:blur(8px);
      color:var(--fg); z-index:20; text-align:center; padding:2rem;
    }
    #gameOver h2 { font-size:2.25rem; margin-bottom:.5rem; }
    #gameOver p  { font-size:1.25rem; margin-bottom:1rem; }
    #gameOver ol {
      width:100%; max-width:340px; list-style:none;
      max-height:180px; overflow-y:auto; margin:0 auto 1rem; padding:0;
    }
    #gameOver ol li {
      background:var(--glass); padding:.5rem; border-radius:.5rem;
      display:flex; justify-content:space-between; font-size:.9rem;
    }
    #gameOver input, #gameOver button {
      width:100%; max-width:340px;
      padding:.7rem 1rem; margin:.3rem 0; border:none; border-radius:.6rem;
      font-size:1rem;
    }
    #gameOver input { background:var(--glass); color:var(--fg); }
    #gameOver button {
      background:var(--accent); color:var(--fg); cursor:pointer;
      transition:transform .1s;
    }
    #gameOver button:active { transform:scale(.96); }
  </style>
</head>
<body>

  <!-- START -->
  <div class="overlay" id="startOverlay">
    <h1>Stick Shot</h1>
    <p>Tap Anywhere to Start</p>
    <small>You’ll be asked for motion / orientation access</small>
  </div>

  <!-- CANVAS -->
  <canvas id="gameCanvas"></canvas>

  <!-- HUD -->
  <div id="hud">
    <div class="hud-box">HP <span id="hp">100</span></div>
    <div class="hud-box">Score <span id="score">0</span></div>
  </div>

  <!-- TOUCH CONTROLS -->
  <div id="controls">
    <div id="dpad">
      <button id="up">▲</button>
      <button id="left">◀</button>
      <button id="down">▼</button>
      <button id="right">▶</button>
    </div>
    <button id="shoot">Shoot</button>
  </div>

  <!-- GAME OVER -->
  <div id="gameOver">
    <h2>Game Over</h2>
    <p>Your Score: <span id="finalScore">0</span></p>
    <ol id="highScores"></ol>
    <input id="playerName" placeholder="Enter your name" maxlength="12">
    <button id="saveScore">Save Score</button>
    <button id="restartGame">Restart</button>
  </div>

  <script src="https://unpkg.com/three@0.155.0/build/three.min.js"></script>
  <script>
    // … (all your setup, factories, etc.) …

    function loop(t){
      const dt = (t - lastTime) / 1000;
      lastTime = t;

      if (!running) {
        renderer.render(scene, camera);
        return;
      }

      // spawn logic …

      // ─────── FIXED movement mapping ───────
      const dx = (moveR ?  1 : 0)   // right → +X
               - (moveL ?  1 : 0),  // left  → –X
           dz = (moveB ?  1 : 0)   // down  → +Z (back)
               - (moveF ?  1 : 0);  // up    → –Z (forward)

      player.position.x += dx * speed * dt;
      player.position.z += dz * speed * dt;

      // rest of your loop: bullets, enemies, camera, render …
      renderer.render(scene, camera);
      if (running) requestAnimationFrame(loop);
    }

    // … (start/reset/end game, high‑scores, etc.) …
  </script>
</body>
</html>